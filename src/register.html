<!DOCTYPE html>

<title>register user</title>

<style>
	table { border: 1px solid silver; }
</style>

<form id="login">
	<table>
		<tr>
			<td><label for="login-email">email</label></td>
			<td><input id="login-email" type="email" required autofocus></td>
		</tr>
		<tr>
			<td><label for="login-password">password</label></td>
			<td><input id="login-password" type="password" required></td>
		</tr>
		<tr>
			<td colspan="2" style="text-align: right">
				<input type="submit" value="login">
			</td>
		</tr>
	</table>
</form>

<br><br><br><br>

<form id="register">
	<table>
		<tr>
			<td><label for="register-email">email</label></td>
			<td><input id="register-email" type="email" required autofocus></td>
		</tr>
		<tr>
			<td><label for="register-password">password</label></td>
			<td><input id="register-password" type="password" required></td>
		</tr>
		<tr>
			<td><label for="confirm-password">confirm password</label></td>
			<td><input id="confirm-password" type="password" required></td>
		</tr>
		<tr>
			<td colspan="2" style="text-align: right">
				<input type="submit" value="register">
			</td>
		</tr>
	</table>
</form>

<br><br><br>

<div id="result"></div>

<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>

<script>
	$(document).ready(function () {
		"use strict";

		var apiUrl  = "http://localhost:3000";
		var $result = $("#result");

		(function () {
			var $registerForm    = $("#register");
			var $password        = $("#register-password");
			var $confirmPassword = $("#confirm-password");

			$password.add($confirmPassword).on("input", function () {
				var passwordsMatch  = ($password.val() === $confirmPassword.val());
				var validityMessage = (passwordsMatch ? "" : "Passwords must match");

				$confirmPassword[0].setCustomValidity(validityMessage);
			});

			$registerForm.on("submit", function (event) {
				event.preventDefault();

				$.post((apiUrl + "/register"), {
					"email"   : $("#register-email").val(),
					"password": $password.val()
				}, function (res) {
					$registerForm.hide();
					$result.html(res);
				});
			});
		}());


		(function () {
			var $loginForm = $("#login");
			var $email     = $("#login-email");
			var $password  = $("#login-password");

			$loginForm.on("submit", function (event) {
				event.preventDefault();

				$.post((apiUrl + "/login"), {
					"email"   : $email.val(),
					"password": $password.val()
				}, function (res) {
					$result.html(res);
				}).fail(function (event) {
					$result.html(event.responseText);

				});
			});

		}());
	});

</script>

